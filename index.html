<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Preposition Quest: Study Edition</title>
    <style>
        :root {
            --primary: #4a90e2; --beginner: #2ecc71; --amateur: #f1c40f;
            --pro: #e67e22; --dark: #2c3e50; --light: #f4f7f6;
        }
        body {
            font-family: 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
            color: var(--dark); display: flex; justify-content: center;
            align-items: center; min-height: 100vh; margin: 0;
        }
        .container {
            background: white; padding: 2.5rem; border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.4); max-width: 800px;
            width: 95%; text-align: center; max-height: 90vh; overflow-y: auto;
        }
        .screen { display: none; }
        .active { display: block; }
        .btn {
            display: block; width: 100%; padding: 15px; margin: 10px 0;
            border: none; border-radius: 10px; color: white;
            font-weight: bold; cursor: pointer; font-size: 1.1rem; transition: 0.2s;
        }
        .btn:hover { opacity: 0.9; transform: translateY(-2px); }
        .bg-beginner { background: var(--beginner); }
        .bg-amateur { background: var(--amateur); color: #333; }
        .bg-pro { background: var(--pro); }
        .bg-main { background: var(--primary); }
        .bg-review { background: #9b59b6; }
        
        .options { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; }
        .prep-btn {
            padding: 20px; border: 2px solid var(--primary);
            background: white; border-radius: 10px; cursor: pointer; font-weight: bold;
        }
        .prep-btn:hover { background: var(--primary); color: white; }
        
        .rule-summary {
            background: #f8f9fa; border-left: 5px solid var(--primary);
            padding: 15px; text-align: left; margin: 20px 0; font-size: 0.9rem;
        }
        .review-item { text-align: left; padding: 15px; border-bottom: 1px solid #eee; }
        .correct { color: #27ae60; font-weight: bold; }
        .incorrect { color: #c0392b; font-weight: bold; }
        input[type="text"] { padding: 12px; width: 80%; border: 2px solid #ddd; border-radius: 8px; margin-bottom: 20px; }
    </style>
</head>
<body>

<div id="login-screen" class="container screen active">
    <h1>üèÜ Preposition Quest</h1>
    <p>Practice <strong>In, On, At</strong> with Destination B1 Rules.</p>
    <input type="text" id="player-name" placeholder="Enter Student Name...">
    <button class="btn bg-main" onclick="startLevelSelection()">Login</button>
</div>

<div id="level-screen" class="container screen">
    <h2 id="welcome-msg"></h2>
    <div class="rule-summary">
        <strong>üí° Quick Mind Map:</strong><br>
        üîº <strong>IN:</strong> Big/General (Years, Countries, Rooms)<br>
        ‚èèÔ∏è <strong>ON:</strong> Specific/Surface (Days, Streets, Islands)<br>
        üîΩ <strong>AT:</strong> Precise/Point (Clock times, Addresses, Activities)
    </div>
    <button class="btn bg-beginner" onclick="startGame('beginner')">Level 1: Beginner Mix</button>
    <button class="btn bg-amateur" onclick="startGame('amateur')">Level 2: Amateur Mix</button>
    <button class="btn bg-pro" onclick="startGame('pro')">Level 3: Pro Mix</button>
    <button class="btn bg-review" onclick="finishSession()" style="margin-top:20px;">üîö End & Review All</button>
</div>

<div id="game-screen" class="container screen">
    <h3 id="current-level-tag"></h3>
    <div id="question-box" style="font-size: 1.4rem; margin: 30px 0;"></div>
    <div class="options">
        <button class="prep-btn" onclick="handleGuess('in')">IN</button>
        <button class="prep-btn" onclick="handleGuess('on')">ON</button>
        <button class="prep-btn" onclick="handleGuess('at')">AT</button>
    </div>
    <div id="feedback" style="margin-top: 20px; font-weight: bold; height: 40px;"></div>
</div>

<div id="round-result-screen" class="container screen">
    <h2>Level Complete!</h2>
    <p id="round-score-text" style="font-size: 1.5rem;"></p>
    <button class="btn bg-main" onclick="showScreen('level-screen')">Back to Map</button>
</div>

<div id="final-screen" class="container screen">
    <h1>Final Scoreboard</h1>
    <h2 id="final-player-name"></h2>
    <div style="font-size: 4rem; color: var(--primary);" id="final-total">0</div>
    <div id="review-area"></div>
    <button class="btn bg-main" onclick="location.reload()">New Session</button>
</div>

<script>
    let playerName = "", sessionScore = 0, currentQuestions = [], questionIndex = 0, roundScore = 0;
    let allSessionLog = [];

    const database = {
        beginner: [
            { q: "Paris is wonderful ____ April.", a: "in", h: "Months (General Time)" },
            { q: "The movie starts ____ 7:00.", a: "at", h: "Clock times (Precise Time)" },
            { q: "I'll be home ____ Sunday.", a: "on", h: "Days (Specific Time)" },
            { q: "I first went to Russia ____ 2005.", a: "in", h: "Years (General Time)" },
            { q: "The apple was ____ the table.", a: "on", h: "Surfaces (Specific Place)" },
            { q: "Let's meet ____ the park.", a: "in", h: "Enclosed areas (General Place)" },
            { q: "Tim was waiting ____ the car.", a: "in", h: "Enclosed space" },
            { q: "Meet me ____ the entrance.", a: "at", h: "Specific point (Precise Place)" },
            { q: "Head to the theater ____ Second Street.", a: "on", h: "Street names" },
            { q: "Your passport is ____ the drawer.", a: "in", h: "Inside an object" },
            { q: "I'll see you ____ the morning.", a: "in", h: "Parts of day" },
            { q: "We often go skiing ____ winter.", a: "in", h: "Seasons" },
            { q: "My office is ____ Main Street.", a: "on", h: "Road/Street locations" },
            { q: "The birds sing ____ sunrise.", a: "at", h: "Specific time point" },
            { q: "Sharon is ____ the travel agent's.", a: "in", h: "Inside a building" }
        ],
        amateur: [
            { q: "My birthday is ____ 19th March.", a: "on", h: "Specific Dates" },
            { q: "We're flying ____ Tuesday morning.", a: "on", h: "Specific day + part of day" },
            { q: "Last year, we stayed ____ Mykonos.", a: "on", h: "Islands (Special Rule)" },
            { q: "What's life like ____ the desert?", a: "in", h: "Large areas/regions" },
            { q: "I'll meet you ____ the bus stop.", a: "at", h: "Point on a journey" },
            { q: "There are Italian phrases ____ page 97.", a: "on", h: "Pages (Special Rule)" },
            { q: "I have a lot of fun ____ my birthday.", a: "on", h: "Specific holidays/events" },
            { q: "I am ____ the middle of my work.", a: "in", h: "Phrase: in the middle of" },
            { q: "Turn ____ the left at the light.", a: "on", h: "Direction phrases" },
            { q: "Meet me ____ the first floor.", a: "on", h: "Floor levels" },
            { q: "What are you doing ____ Christmas?", a: "at", h: "Holiday periods (Duration)" },
            { q: "I am very busy ____ the moment.", a: "at", h: "Phrase: at the moment" },
            { q: "I've left the tickets ____ the living room.", a: "in", h: "Rooms" },
            { q: "I can't see well ____ night.", a: "at", h: "Phrase: at night" },
            { q: "The tickets are ____ the counter.", a: "on", h: "Surfaces" }
        ],
        pro: [
            { q: "My cousin lives ____ 132 London Road.", a: "at", h: "Specific address (Number + Street)" },
            { q: "John is ____ the cinema.", a: "at", h: "Buildings (Focus on activity)" },
            { q: "Rania isn't here. She's ____ a party.", a: "at", h: "Specific Activities" },
            { q: "I should be home ____ a week or two.", a: "in", h: "Unspecific time span" },
            { q: "Look ____ the bottom of the page.", a: "at", h: "Relative positions" },
            { q: "Who is standing ____ the door?", a: "at", h: "Precise point" },
            { q: "We're spending our holiday ____ the countryside.", a: "in", h: "Large areas all around us" },
            { q: "There's a bus ____ ten past three.", a: "at", h: "Exact Clock times" },
            { q: "What's it like ____ the North Pole?", a: "at", h: "Exact places" },
            { q: "Snow falls ____ Christmas time.", a: "at", h: "Holiday periods" },
            { q: "Put the stamp ____ the top-right corner.", a: "in", h: "Inside a corner area" },
            { q: "Wait ____ the entrance until I arrive.", a: "at", h: "Target point" },
            { q: "Is there anything good ____ television tonight?", a: "on", h: "Media/Screens" },
            { q: "I'll be ready ____ an hour.", a: "in", h: "Future time phrase" },
            { q: "The kids are playing ____ the beach.", a: "on", h: "Phrase: on the beach" }
        ]
    };

    function showScreen(id) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        if(id === 'level-screen') document.getElementById('session-total').innerText = sessionScore;
    }

    function startLevelSelection() {
        playerName = document.getElementById('player-name').value || "Student";
        document.getElementById('welcome-msg').innerText = `Greetings, ${playerName}!`;
        showScreen('level-screen');
    }

    function startGame(level) {
        currentQuestions = [...database[level]].sort(() => Math.random() - 0.5);
        questionIndex = 0; roundScore = 0;
        document.getElementById('current-level-tag').innerText = `Difficulty: ${level.toUpperCase()}`;
        showScreen('game-screen');
        nextQuestion();
    }

    function nextQuestion() {
        if (questionIndex < currentQuestions.length) {
            const q = currentQuestions[questionIndex];
            document.getElementById('question-box').innerHTML = q.q.replace("____", "<span style='color:var(--primary); text-decoration: underline'>____</span>");
            document.getElementById('feedback').innerText = "";
        } else {
            sessionScore += roundScore;
            document.getElementById('round-score-text').innerText = `Level Score: ${roundScore} / ${currentQuestions.length}`;
            showScreen('round-result-screen');
        }
    }

    function handleGuess(choice) {
        const q = currentQuestions[questionIndex];
        const isCorrect = (choice === q.a);
        allSessionLog.push({ q: q.q, user: choice, correct: q.a, rule: q.h, status: isCorrect });

        const feedback = document.getElementById('feedback');
        if (isCorrect) {
            roundScore++; feedback.style.color = "green";
            feedback.innerText = "Correct! ‚ú®";
        } else {
            feedback.style.color = "red";
            feedback.innerText = `Incorrect. The answer was ${q.a.toUpperCase()}.`;
        }
        setTimeout(() => { questionIndex++; nextQuestion(); }, 1200);
    }

    function finishSession() {
        document.getElementById('final-player-name').innerText = playerName;
        document.getElementById('final-total').innerText = sessionScore;
        const reviewArea = document.getElementById('review-area');
        reviewArea.innerHTML = "<h3>Review Your Answers:</h3>";
        
        allSessionLog.forEach(item => {
            const div = document.createElement('div');
            div.className = "review-item";
            div.innerHTML = `
                <div><strong>${item.q.replace("____", item.user.toUpperCase())}</strong></div>
                <div class="${item.status ? 'correct' : 'incorrect'}">${item.status ? '‚úì Correct' : '‚úó Incorrect (Correct: ' + item.correct.toUpperCase() + ')'}</div>
                <div style="font-size:0.8rem; color:#666 italic">B1 Rule: ${item.rule}</div>
            `;
            reviewArea.appendChild(div);
        });
        showScreen('final-screen');
    }
</script>
</body>
</html>